"use strict";(self.webpackChunknelverse=self.webpackChunknelverse||[]).push([[8080],{28453:(e,t,i)=>{i.d(t,{R:()=>s,x:()=>o});var l=i(96540);const r={},n=l.createContext(r);function s(e){const t=l.useContext(n);return l.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),l.createElement(n.Provider,{value:t},e.children)}},76164:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>y,contentTitle:()=>m,default:()=>b,frontMatter:()=>x,metadata:()=>l,toc:()=>f});const l=JSON.parse('{"id":"probability/kelly","title":"Kelly Criterion","description":"This page demonstrates the Kelly Criterion interactively. Use the slider to scale the optimal fraction.","source":"@site/labs/probability/kelly.mdx","sourceDirName":"probability","slug":"/probability/kelly-criterion","permalink":"/labs/probability/kelly-criterion","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Kelly Criterion","slug":"kelly-criterion"},"sidebar":"defaultSidebar","previous":{"title":"Probability","permalink":"/labs/category/probability"}}');var r=i(74848),n=i(28453),s=i(78478),o=i(96540);function a(e,t){return 0===t?0:(t*e-(1-e))/t}function d(e,t,i,l,r){const n=[];for(let s=0;s<r;s++){let r=1;const s=[r];for(let n=0;n<l;n++){const l=Math.random()<e?1+i*t:1-i;r=Math.max(1e-9,r*l),s.push(r)}n.push(s)}return n}const h=[{type:"rect",xref:"x",yref:"paper",x0:0,x1:.8,y0:0,y1:1,fillcolor:"rgba(46, 204, 113, 0.2)",line:{width:0},layer:"below"},{type:"rect",xref:"x",yref:"paper",x0:.8,x1:1.5,y0:0,y1:1,fillcolor:"rgba(241, 196, 15, 0.2)",line:{width:0},layer:"below"},{type:"rect",xref:"x",yref:"paper",x0:1.5,x1:2,y0:0,y1:1,fillcolor:"rgba(231, 76, 60, 0.18)",line:{width:0},layer:"below"}];function u({odds:e=2,edge:t=.55,simulations:l=1e3,paths:n=40}){const s=(0,o.useRef)(null),u=(0,o.useRef)(null),c=(0,o.useRef)(null),[p,x]=(0,o.useState)(e),[m,y]=(0,o.useState)(t),[f,g]=(0,o.useState)(l),[b,j]=(0,o.useState)(n),[v,w]=(0,o.useState)(0),k=(0,o.useMemo)((()=>{const e=Array.from({length:21},((e,t)=>t/10)),t=[],i=[],l=[];return e.forEach((e=>{const r=function(e,t,i,l){const r=a(e,t),n=Math.max(0,r*i);let s=0;const o=[];for(let a=0;a<l;a++){const i=Math.random()<e?1+n*t:1-n,l=Math.log(Math.max(1e-9,i));s+=l,o.push(l)}const d=s/l,h=o.reduce(((e,t)=>e+(t-d)**2),0)/l,u=Math.sqrt(h);return{growthRate:100*(Math.exp(d)-1),volatility:100*u}}(m,p,e,f);t.push(r.growthRate),i.push(r.volatility),l.push(r.volatility>1e-6?r.growthRate/r.volatility:null)})),{kellyMultipliers:e,growthRates:t,volatilities:i,riskAdjusted:l}}),[p,m,f]),M=(0,o.useMemo)((()=>{const e=a(m,p),t=Math.min(Math.max(b,10),50),i=Array.from({length:101},((e,t)=>t)),l=[];return[.4,.7,1,1.5].forEach(((r,n)=>{const s=d(m,p,e*r,100,t),o=["#ff7f0e","#2ca02c","#1f77b4","#d62728"][n],a=i.map(((e,t)=>s.reduce(((e,i)=>e+i[t]),0)/s.length)),h=[],u=[];s.forEach((e=>{e.forEach(((e,t)=>{u.push(i[t]),h.push(e)})),u.push(null),h.push(null)})),l.push({x:u,y:h,mode:"lines",line:{width:.2,color:o,opacity:.15},name:`${r}\xd7 Kelly (paths)`,showlegend:!0,legendgroup:`kelly-${r}`}),l.push({x:i,y:a,mode:"lines",line:{width:5,color:o},name:`${r}\xd7 Kelly (avg)`,showlegend:!0,legendgroup:`kelly-${r}`})})),l}),[m,p,b,v,f]),C=(0,o.useMemo)((()=>{const e=a(m,p),t=Math.min(Math.max(b,10),50),i=[];return[.4,.7,1,1.5].forEach(((l,r)=>{const n=d(m,p,e*l,100,t),s=["#ff7f0e","#2ca02c","#1f77b4","#d62728"][r],o=n.map((e=>e[e.length-1])).map((e=>Math.log10(Math.max(e,1e-10))));i.push({x:o,type:"histogram",name:`${l}\xd7 Kelly`,marker:{color:s,opacity:.4},nbinsx:20,histnorm:"probability density"})})),i}),[m,p,b,v,f]);return(0,o.useEffect)((()=>{let e=!1;return(async()=>{if(!s.current)return;const t=(await i.e(4708).then(i.t.bind(i,84708,23))).default,l=[{x:k.kellyMultipliers,y:k.growthRates,name:"AVG Growth Rate",mode:"lines",line:{color:"steelblue"},yaxis:"y1"},{x:k.kellyMultipliers,y:k.volatilities,name:"AVG Volatility",mode:"lines",line:{color:"crimson"},yaxis:"y2"},{x:k.kellyMultipliers,y:k.riskAdjusted,name:"Return/Volatility",mode:"lines",line:{color:"darkgreen",dash:"dot"},yaxis:"y3"}],r={title:{text:"Kelly Multiplier vs Growth Rate & Volatility"},xaxis:{title:{text:"Kelly Multiplier (K)"}},yaxis:{title:{text:"AVG Return (%)"},tickformat:".1f",ticksuffix:"%",zeroline:!0},yaxis2:{title:{text:"AVG Volatility (%)"},overlaying:"y",side:"right",tickformat:".1f",ticksuffix:"%",zeroline:!1},yaxis3:{overlaying:"y",side:"right",position:1.08,showticklabels:!1,ticks:"",title:{text:""},zeroline:!1},shapes:h,margin:{t:60,r:90,b:60,l:60}};await t.newPlot(s.current,l,r,{displayModeBar:!1}),e&&t.purge(s.current)})(),()=>{e=!0}}),[k]),(0,o.useEffect)((()=>{let e=!1;return(async()=>{if(!u.current)return;const t=(await i.e(4708).then(i.t.bind(i,84708,23))).default;await t.newPlot(u.current,M,{title:"Monte Carlo Growth Paths: Different Kelly Multipliers",margin:{t:60,r:10,b:60,l:50},xaxis:{title:{text:"Bet counter"}},yaxis:{title:{text:"Bankroll"},rangemode:"tozero",type:"log"},showlegend:!0},{displayModeBar:!1}),e&&t.purge(u.current)})(),()=>{e=!0}}),[M]),(0,o.useEffect)((()=>{let e=!1;return(async()=>{if(!c.current)return;const t=(await i.e(4708).then(i.t.bind(i,84708,23))).default;await t.newPlot(c.current,C,{title:{text:"Distribution of Ending Portfolio Values (Log Scale)"},margin:{t:60,r:10,b:60,l:50},xaxis:{title:{text:"Log\u2081\u2080(Final Portfolio Value)"},type:"linear",tickformat:".1f"},yaxis:{title:{text:"Probability Density"}},showlegend:!0,barmode:"overlay",shapes:[{type:"line",xref:"x",yref:"paper",x0:0,x1:0,y0:0,y1:1,line:{color:"black",width:2,dash:"dash"}}],annotations:[{x:0,y:.95,xref:"x",yref:"paper",text:"Ruin",showarrow:!1,font:{size:12,color:"black"},bgcolor:"rgba(255,255,255,0.8)",bordercolor:"black",borderwidth:1}]},{displayModeBar:!1}),e&&t.purge(c.current)})(),()=>{e=!0}}),[C]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"grid",gap:8,gridTemplateColumns:"repeat(4, 1fr)",marginBottom:16},children:[(0,r.jsxs)("label",{children:["odds: ",p.toFixed(1),(0,r.jsx)("input",{type:"range",min:.8,max:5,step:.1,value:p,onChange:e=>x(Number(e.target.value))})]}),(0,r.jsxs)("label",{children:["edge: ",(100*m).toFixed(0),"%",(0,r.jsx)("input",{type:"range",min:.4,max:.99,step:.01,value:m,onChange:e=>y(Number(e.target.value))})]}),(0,r.jsxs)("label",{children:["sims: ",f,(0,r.jsx)("input",{type:"range",min:100,max:5e3,step:100,value:f,onChange:e=>g(Number(e.target.value))})]}),(0,r.jsxs)("label",{children:["paths: ",b,(0,r.jsx)("input",{type:"range",min:10,max:100,step:5,value:b,onChange:e=>j(Number(e.target.value))})]})]}),(0,r.jsxs)("div",{style:{fontSize:"0.9em",color:"#666",marginBottom:16},children:["Monte Carlo uses 100 trials and ",Math.min(Math.max(b,10),50)," paths"]}),(0,r.jsx)("div",{style:{marginBottom:32},children:(0,r.jsx)("div",{ref:s,style:{height:600,width:"100%"}})}),(0,r.jsxs)("div",{style:{marginBottom:32},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,r.jsx)("h3",{children:"Monte Carlo Growth Paths"}),(0,r.jsx)("button",{onClick:()=>w(v+1),style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"New Simulation"})]}),(0,r.jsx)("div",{ref:u,style:{height:500,width:"100%"}})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,r.jsx)("h3",{children:"Ending Portfolio Value Distribution"}),(0,r.jsx)("button",{onClick:()=>w(v+1),style:{padding:"8px 16px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"New Simulation"})]}),(0,r.jsx)("div",{ref:c,style:{height:500,width:"100%"}})]})]})}function c(e,t){return 0===t?0:(t*e-(1-e))/t}function p({pSteps:e=21,bSteps:t=21,maxOdds:l=20,kellyMultiplier:n=1}){const s=(0,o.useRef)(null),[a,d]=(0,o.useState)(l),[h,u]=(0,o.useState)(e),[p,x]=(0,o.useState)(t),[m,y]=(0,o.useState)(n),f=(0,o.useMemo)((()=>{const e=Array.from({length:h},((e,t)=>t/(h-1)*100)),t=Array.from({length:p},((e,t)=>t/(p-1)*a)),i=t.map((()=>Array(e.length).fill(0)));for(let l=0;l<t.length;l++)for(let r=0;r<e.length;r++){const n=e[r]/100,s=Math.max(0,c(n,t[l]));i[l][r]=100*Math.min(1,s*m)}return{pVals:e,bVals:t,z:i}}),[h,p,a,m]);return(0,o.useEffect)((()=>{let e=!1;return(async()=>{if(!s.current)return;const t=(await i.e(4708).then(i.t.bind(i,84708,23))).default,l=[{x:f.pVals,y:f.bVals,z:f.z,type:"heatmap",colorscale:"Viridis",reversescale:!1,zmin:0,zmax:100,colorbar:{title:"Bet size (%)",tickformat:".0f",ticksuffix:"%"}}];await t.newPlot(s.current,l,{title:{text:"<b>Kelly Bet Size</b>",font:{size:14}},xaxis:{title:{text:"Assumed probability (%)",font:{size:12}},tickformat:".0f",ticksuffix:"%"},yaxis:{title:{text:"Winnings multiplier",font:{size:12}}},zaxis:{title:{text:"Bet size",font:{size:12}}},margin:{t:60,r:10,b:60,l:60}},{displayModeBar:!1}),e&&t.purge(s.current)})(),()=>{e=!0}}),[f]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"grid",gap:8,gridTemplateColumns:"repeat(3, 1fr)"},children:[(0,r.jsxs)("label",{children:["max odds: ",a.toFixed(0),(0,r.jsx)("input",{type:"range",min:5,max:50,step:1,value:a,onChange:e=>d(Number(e.target.value))})]}),(0,r.jsxs)("label",{children:["p steps: ",h,(0,r.jsx)("input",{type:"range",min:11,max:101,step:2,value:h,onChange:e=>u(Number(e.target.value))})]}),(0,r.jsxs)("label",{children:["odds steps: ",p,(0,r.jsx)("input",{type:"range",min:11,max:51,step:2,value:p,onChange:e=>x(Number(e.target.value))})]}),(0,r.jsxs)("label",{children:["Kelly K: ",m.toFixed(1),(0,r.jsx)("input",{type:"range",min:.1,max:2,step:.1,value:m,onChange:e=>y(Number(e.target.value))})]})]}),(0,r.jsx)("div",{ref:s,style:{height:600,width:"100%"}})]})}const x={title:"Kelly Criterion",slug:"kelly-criterion"},m=void 0,y={},f=[{value:"Return vs. Volatility &amp; Monte Carlo",id:"return-vs-volatility--monte-carlo",level:2},{value:"Heatmap",id:"heatmap",level:2}];function g(e){const t={admonition:"admonition",h2:"h2",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,n.R)(),...e.components},{Details:i}=t;return i||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"This page demonstrates the Kelly Criterion interactively. Use the slider to scale the optimal fraction."}),"\n",(0,r.jsx)(t.h2,{id:"return-vs-volatility--monte-carlo",children:"Return vs. Volatility & Monte Carlo"}),"\n",(0,r.jsxs)(t.admonition,{type:"info",children:[(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Parameters"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Odds: Winnings multiplier (1.0 = even odds, 2.0 = double your money)"}),"\n",(0,r.jsx)(t.li,{children:"Edge: Probability of winning"}),"\n",(0,r.jsx)(t.li,{children:"Sims: Simulated trials for return/volatility analysis"}),"\n",(0,r.jsx)(t.li,{children:"Paths: Number of independent simulation runs (10-50 range)"}),"\n"]})]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Top Chart (Return vs. Volatility):"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"X: Kelly multiplier"}),"\n",(0,r.jsx)(t.li,{children:"Y1: Expected log growth rate (blue curve)"}),"\n",(0,r.jsx)(t.li,{children:"Y2: Standard deviation of log growth (red curve)"}),"\n",(0,r.jsx)(t.li,{children:"Y3: Risk-adjusted growth (Green dotted)"}),"\n"]}),(0,r.jsx)(t.admonition,{title:"Help",type:"success",children:(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Green shaded refers to optimal risk-adjusted Kelly range"}),"\n",(0,r.jsx)(t.li,{children:"Yellow shaded refers to growth maximizing range"}),"\n",(0,r.jsx)(t.li,{children:"Red shaded refers to ruin range"}),"\n"]})}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Middle Chart (Monte Carlo Paths):"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Shows 4 Kelly multiplier strategies: 0.25\xd7, 0.5\xd7, 1\xd7, 1.5\xd7 Kelly"}),"\n",(0,r.jsx)(t.li,{children:"Each line shows multiple simulation paths with average highlighted"}),"\n",(0,r.jsx)(t.li,{children:"Uses 10% of sims for trials to conserve bandwidth"}),"\n",(0,r.jsx)(t.li,{children:'Click "New Simulation" to generate fresh random paths'}),"\n"]}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Bottom Chart (Ending Value Distribution):"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Histogram showing distribution of final portfolio values"}),"\n",(0,r.jsx)(t.li,{children:"Overlaid histograms for each Kelly multiplier"}),"\n",(0,r.jsx)(t.li,{children:"X-axis shows log\u2081\u2080 of final portfolio values (linear scale)"}),"\n",(0,r.jsx)(t.li,{children:"Shows probability density of different outcomes"}),"\n"]})]}),"\n",(0,r.jsx)(t.p,{children:"Recommended bet size should be below 0.8 K. At K greater than 1.5, your chances of ruin gets extremely high."}),"\n",(0,r.jsx)(t.p,{children:"In fact, you notice that ruin can happen even before K reaches 1.5 when your edge or odds goes high enough."}),"\n",(0,r.jsx)(t.p,{children:"That is another way of saying Kelly sometimes gets too overconfident in certain games, and recommends you to bet extremely big (more than 60% of your portfolio), which may work out well in few iterations, but one big loss is enough to wipe you off."}),"\n",(0,r.jsx)(s.A,{children:()=>(0,r.jsx)(u,{odds:2,edge:.55,simulations:1e3,paths:40})}),"\n",(0,r.jsx)(t.p,{children:"You notice at K=0.7, you would already outperformed a K=1 strategy 50% from the probability density chart at 100 games."}),"\n",(0,r.jsx)(t.p,{children:"However, if you simply observe the average results from a Monte Carlo simulations, you would have think that K=1 is the best strategy."}),"\n",(0,r.jsx)(t.p,{children:"This is the kind of information what most people ends up missing. What works in theory is not always the most practical strategy in real life."}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"heatmap",children:"Heatmap"}),"\n",(0,r.jsxs)(t.admonition,{type:"info",children:[(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Parameters"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Max odds: Maximum winnings multiplier to display (e.g., 2.0 = double your money)"}),"\n",(0,r.jsx)(t.li,{children:"P steps: Number of probability intervals (more = smoother heatmap)"}),"\n",(0,r.jsx)(t.li,{children:"Odds steps: Number of multiplier intervals (more = smootherheatmap)"}),"\n",(0,r.jsx)(t.li,{children:"K: Kelly multiplier"}),"\n"]}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Axis"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"X: Assumed probability of winnings"}),"\n",(0,r.jsx)(t.li,{children:"Y: Assumed profit from winnings"}),"\n",(0,r.jsx)(t.li,{children:"Z: Kelly optimal bet size"}),"\n"]})]}),"\n",(0,r.jsx)(s.A,{children:()=>(0,r.jsx)(p,{pSteps:51,bSteps:21,maxOdds:20})})]})}function b(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}},78478:(e,t,i)=>{i.d(t,{A:()=>n});i(96540);var l=i(92303),r=i(74848);function n({children:e,fallback:t}){return(0,l.A)()?(0,r.jsx)(r.Fragment,{children:e?.()}):t??null}}}]);